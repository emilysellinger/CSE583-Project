# Component Specification
## Components
**E-bird Data Cleanup**  
We reduced the E-bird sighting dataset from January 2020 to November 2020 in Oregon. For this project we are focusing on permanent Oregon resident species. We removed extraneous columns from the dataset such as “Has Media”, “Trip Comments” and “Species Comments.”

**Air Quality Data Setup** 
Air Quality data was scraped from PDFs generated by the Oregon Department of Environmental Quality, and manipulated before being used in this package. Measurements that were not needed for our analysis were removed, and columns were renamed so they matched across stations. Hourly data was averaged so that a 24-hour average PM 2.5 for each station on each day was calculated. The EPA's PM 2.5 breakpoint table was used to assign each day an Air Quality Index category. 

**Air Quality KNN (phoenix/code/air_quality_knn.py)**
We use the Scikit Learn k-nearest neighbors method to assign air quality measurements to the latitude and longitude of each bird observation. This accounts for the difference in the sensor locations and the bird observations. This module does the following:
-Performs k-nearest-neighbors for each data point in the ebird dataset, and assigns it an air quality value based on the nearest Oregon PM 2.5 sensor.
-Checks that all the coordinates used in the data are within the state of Oregon.

Python packages used:
-Scikit Learn

**Adding Oregon Counties to Air Quality Data (phoenix/code/data_cleaning.py) **
We use a module to calculate the average PM 2.5 rating for each county in Oregon for each day.
This function does the following:
- Adds the county the station is located in to the air quality dataset
-Calculates the average PM 2.5 rating for each county on each day
-Assigns the nearest county's PM 2.5 rating to counties that do not have air quality sensors. 
-Assigns the categorical EPA Air Quality Index categories to each county on each day given their PM 2.5 rating.

Python packages used: 
-Pandas

**App Functions (phoenix/code/app_functions.py)**
We use a module to organize some of the functions that subset the data for visualization in the dash app. These include:
-subset_date:
--Uses the month and day selected in the dropdown menu to subset the air quality and ebird datasets to only that specific date.
-subset_air_quality:
--Uses the county specified in the dropdown menu to subset the air quality data.
--New dataframes are created which contain only dates that are rated Very Unhealthy or Hazardous by the EPA.
--A new column called "Data Offset" is added to these new dataframes that allow for easier plotting of shaded rectangles in the dash app below.
--These new dataframes are then converted to lists so they can be used with plotly.

Python packages used:
-Pandas

**Plotly visualizations (phoenix/code/app.py)**  
A variety of interactive maps and plots will be used to visualize the effects of air quality on resident bird sightings in Oregon. These visualizations include:
- A choropleth map of Oregon with shaded counties representing their PM 2.5 rating as well as circles representing bird sightings ( with the size representing the numberr of birds sighted) for resident bird species. This map has a time slider that allows the user to see how air quality and sightings change from day to day between June 2020 and November 2020. Additionally, it will have the ability to select which family orspecies the user wants to view.
- A chart of the number of sightings for  Oregon resident bird species over time. Shaded rectangles represent the days with Very Unhealthy or Hazardous air quality ratings in the county selected. 

Python packages used:
- Plotly

**Birder Dash App (phoenix/code/app.py)**
  
The interactive visualizations created through plotly will be organized into a dashboard using dash, deployed using Heroku and then shared by embedding the html in a website. For demonstration purposes, a github website was created to show how this app could be shared.

Python packages used:
- Dash


**Researcher Visualizations (phoenix/demos/Researcher_Demo.ipynb)**
We use a Jupyter Notebook to complete some basic statistical analyses that might be interesting to an ecologist or biologist interested in how bird sightings changed with the Oregon wildfires in 2020. This notebook contains:
-Visualizations of relationships between air quality and observation counts
-One-way anova to look for statistical relationships between the Air Quality Index and the observation counts
-Suggestions for further areas of research and analysis

Python packages used:
- Jupyter Notebook
- Altair

## Interactions

**Birder:**
A birder who lives in a county that was hard hit by the Oregon wildfires this summer is noticing that she is seeing less American crows this month than usual. She goes onto the Portland Audubon society website and finds the PHOENIX dashboard. The app uses the cleaned dataset to present a few visualizations. She uses the menus on the choropleth map to select Redwing Blackbirds and the month of September, when the fires hit hardest. The dashboard uses these inputs to subset the data so she only sees what she is most interested in. She uses the slider to watch as sightings and air quality changes over time. She notices that this species disappeared almost completely after the wildfires in her area, but that they are still commonly sighted across Oregon. She also examines sightings for all of the birds in her county in the scatterplot. She notices that around the time of very unealthy and hazardous air quality ratings most bird sightings completely drop off, but that they begin to rise again after.

**Researcher**
An ecologist interested in corvids in Oregon wonders if this family might have been impacted by the Oregon wildfires this year. She installs our package and opens the jupyter notebook. She uses the cleaned ebird data and the assigned PM 2.5 ratings to these sighting locations from our knn regression module in the jupyter notebook. She uses the Altair visualizations to explore the relationships between observation counts and air quality. She even changes some of the inputs for the visualizations so they color the markers based on family so she can really see what is occuring with the corvids which she is most interested in. She examines the results of the One-Way ANOVA, and agrees that this warrants further investigation. She might even export the bird dataframe that has included air quality information as a csv which she can then use on her own for further statistical analyses. 

## List of Tasks (in priority order):  
Week 1
- Submit software design documents
- Air Quality data retrieval
- Create environment.yml
- Add license information to repo
- Data Cleanup
  - Air Quality
  - eBird Sightings
- Compile list of resident bird species
- Determine stat analysis for 1st use case

Week 2
- Link Travis CI to repo
- Visualization skeleton for use cases
  - Graphs for researchers
  - Dashboard for birders
- Code quality and comments

Week 3
- Add needed unit tests
- Ensure code is properly commented
- Prepare for project previews

Week 4
- Present project preview
  - Make any code updates following project previews
  - Update software design documents and README.md file to reflect current project direction
- Practice for final project presentation
